name: Node.js CI
on:

  push:

    branches: [ main ]

  pull_request:

    branches: [ main ]
jobs:

  build:
    runs-on: ubuntu-latest
    strategy:

      matrix:

        node-version: [18.x]
    steps:

      - uses: actions/checkout@v3

      - name: Use Node.js ${{ matrix.node-version }}

        uses: actions/setup-node@v3

        with:

          node-version: ${{ matrix.node-version }}

      - run: npm ci

      - run: npm run build --if-present

      - run: npm test
    # Service containers to run with `runner-job`

    services:

      # Label used to access the service container

      redis:

        # Docker Hub image

        image: redis

        # Set health checks to wait until redis has started

        options: >-

          --health-cmd "redis-cli ping"

          --health-interval 10s

          --health-timeout 5s

          --health-retries 5

        ports:

          # Maps port 6379 on service container to the host

          - 6379:6379